2024-05-06T10:05:01.294171+0545 - [Info]: ########################## Operations in DWH_LOCATION_LU Table ##########################
2024-05-06T10:05:01.294171+0545 - ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2024-05-06T10:05:02.176865+0545 - [Info]: Snowflake has been connected successfully
2024-05-06T10:05:02.177475+0545 - ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2024-05-06T10:05:02.177942+0545 - [Info]: Creating Temp Table: TEMP_LOCATION_LU
2024-05-06T10:05:02.180508+0545 - ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2024-05-06T10:05:02.289376+0545 - [Info]: Query has been executed successfully: 
CREATE TABLE IF NOT EXISTS TEMP_LOCATION_LU(
                    LOC_ID INT,
                    LOC_NAME VARCHAR(40),
                    LOC_DESC VARCHAR(40),
                    LOC_IS_ACTIVE BOOLEAN,
                    LOC_START_DATE TIMESTAMP_LTZ,
                    LOC_IS_OPEN BOOLEAN
                    )
2024-05-06T10:05:02.289591+0545 - ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2024-05-06T10:05:02.289591+0545 - [Info]: If table already exists then truncating temp table: TEMP_LOCATION_LU
2024-05-06T10:05:02.290373+0545 - ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2024-05-06T10:05:02.504539+0545 - [Info]: Query has been executed successfully: TRUNCATE TEMP_LOCATION_LU
2024-05-06T10:05:02.504539+0545 - ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2024-05-06T10:05:02.839843+0545 - [Info]: Query has been executed successfully: INSERT INTO TEMP_LOCATION_LU (select * from V_LOCATION_TR)
2024-05-06T10:05:02.840827+0545 - ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2024-05-06T10:05:02.840991+0545 - [Info]: Creating Target Table: DWH_LOCATION_LU
2024-05-06T10:05:02.840991+0545 - ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2024-05-06T10:05:02.923895+0545 - [Info]: Query has been executed successfully: 
CREATE TABLE IF NOT EXISTS DWH_LOCATION_LU(
                    LOC_KEY INT,
                    LOC_ID INT,
                    LOC_NAME VARCHAR(40),
                    LOC_DESC VARCHAR(40),
                    LOC_IS_ACTIVE BOOLEAN,
                    LOC_START_DATE TIMESTAMP_LTZ,
                    LOC_IS_OPEN BOOLEAN,
                    REC_START_TS TIMESTAMP_LTZ,
                    REC_END_TS TIMESTAMP_LTZ,
                    REC_CLOSE_FLG BOOLEAN
                    )
2024-05-06T10:05:02.924729+0545 - ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2024-05-06T10:05:02.924729+0545 - [Info]: Updating and Inserting Target Table: DWH_LOCATION_LU under SCD Type-1 Approach
2024-05-06T10:05:02.924729+0545 - ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2024-05-06T10:05:03.479223+0545 - [Info]: Query has been executed successfully: 
                MERGE INTO DWH_LOCATION_LU AS TG
                USING TEMP_LOCATION_LU AS TM
                ON TG.LOC_ID = TM.LOC_ID
                WHEN MATCHED AND ((TG.LOC_NAME <> TM.LOC_NAME) OR (TG.LOC_DESC <> TM.LOC_DESC) OR (TG.LOC_IS_ACTIVE <> TM.LOC_IS_ACTIVE) OR (TG.LOC_IS_OPEN <> TM.LOC_IS_OPEN) OR (TG.LOC_START_DATE <> TM.LOC_START_DATE))
                THEN UPDATE SET
                TG.LOC_NAME = TM.LOC_NAME,
                TG.LOC_DESC = TM.LOC_DESC,
                TG.LOC_IS_ACTIVE = TM.LOC_IS_ACTIVE,
                TG.LOC_IS_OPEN = TM.LOC_IS_OPEN,
                TG.LOC_START_DATE = TM.LOC_START_DATE,
                TG.REC_START_TS = CURRENT_TIMESTAMP,
                TG.REC_END_TS = '2199-12-31 23:59:59.999999'
                WHEN NOT MATCHED
                THEN INSERT (LOC_KEY,LOC_ID,LOC_NAME,LOC_DESC,LOC_IS_ACTIVE,LOC_START_DATE,LOC_IS_OPEN,REC_START_TS,REC_END_TS,REC_CLOSE_FLG)
                VALUES(COALESCE((SELECT MAX(LOC_ID) FROM TEMP_LOCATION_LU WHERE LOC_ID>=0), 0) + RANK() OVER (ORDER BY LOC_ID),
                TM.LOC_ID,TM.LOC_NAME,TM.LOC_DESC,TM.LOC_IS_ACTIVE,TM.LOC_START_DATE,TM.LOC_IS_OPEN,CURRENT_TIMESTAMP, '2199-12-31 23:59:59.999999',FALSE) 
                
2024-05-06T10:05:03.479223+0545 - ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2024-05-06T10:05:03.480293+0545 - [Info]: Closing Inactives of: DWH_LOCATION_LU under SCD Type-1 Approach
2024-05-06T10:05:03.480293+0545 - ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2024-05-06T10:05:03.822194+0545 - [Info]: Query has been executed successfully: 
            UPDATE DWH_LOCATION_LU
            SET REC_CLOSE_FLG = TRUE,
            REC_END_TS = CURRENT_TIMESTAMP
            WHERE LOC_ID NOT IN
            (SELECT DISTINCT LOC_ID FROM TEMP_LOCATION_LU)
            
2024-05-06T10:05:03.823203+0545 - ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2024-05-06T10:05:03.823203+0545 - [Info]: ETL of Table: DWH_LOCATION_LU  has been completed successfully!!!
2024-05-06T10:05:03.823203+0545 - ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2024-05-06T10:05:03.946884+0545 - [Info]: Connection has been closed successfully
2024-05-06T10:05:03.946884+0545 - ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
